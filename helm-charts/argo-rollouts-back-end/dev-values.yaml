rollout:
  app:
    env: prod
  name: back-end-argo-cd-roll-out
  namespace: argo-cd-rollout-back-end-dev-namespace
  replicas: 6
  strategy:
    canary:
      steps:
        - setWeight: 20
        - pause: { duration: 20m }
        - analysis: # TODO -> ðŸ‘‰â€œBefore moving to the next canary step, run a health check based on metrics.â€ : Most production-safe approach âœ…
            templates:
              - templateName: error_rate
              - templateName: latency
              - templateName: pod-restarts

        - setWeight: 40
        - pause: { duration: 15m }
        - analysis:
            templates:
              - templateName: cpu-usage
              - templateName: memory-usage
              - templateName: dependency-health

        - setWeight: 60
        - pause: { duration: 20m }
        - analysis: # TODO _> ðŸ‘‰ â€œBefore moving to the next canary step, check application latency using a predefined analysis template.â€
            templates:
              - templateName: latency
              - templateName: success-rate

        - setWeight: 80
        - pause: { duration: 10m }

        - setWeight: 100

# TODO ->  Deployment label should be match with rollout label if you want to rollout you new version
container:
  name: springbootcontainer
  image: srinu641/spring-application-k8s
  tag: v3.0
  port: 1199

